import e from"debug";import t from"fs";import r from"node:fs";import s from"node:path";const n=e("@foo-dog:utils");function o(e){return n("isSupportedFileExtension(): fileExtWithDot="+e),".pug"==e.toLowerCase()||".foo-dog"==e.toLowerCase()}function i(e){try{return t.accessSync(e),!0}catch(e){return!1}}function a(e){try{return t.accessSync(e,t.constants.R_OK),!0}catch(e){}return!1}function c(e){t.mkdirSync(e,{recursive:!0})}function l(){const e=process.cwd();let r=!0;for(;r;)try{t.accessSync("package.json",t.constants.F_OK),r=!1}catch(e){process.chdir("..")}const s=process.cwd();return process.chdir(e),s}Array.prototype.peek=function(){return this[this.length-1]},String.prototype.removeFromEnd=function(e){return this.endsWith(e)?this.substring(0,this.lastIndexOf(e)):this.toString()};const u=e("@foo-dog/utils:parse_arguments"),p="file:///workspaces/utils/src/parse_arguments.js".endsWith("?test");var d=async function(e,t,n){null==n&&(n=null!==t&&"object"==typeof t?t:{}),n.optional;const o=n.required??[];u("options.required=",n.required),u("requiredParams=",o);const i={};let l;var d;if(u("processOrArgv=",d=e),"object"==typeof d&&d.hasOwnProperty("argv")&&d.argv[0].startsWith("/")&&"node"===d.title?(i.nodePath=e.argv[0],i.program=e.argv[1],l=e.argv.slice(2)):l=(null==e?void 0:e.argv)||e,l.includes("-h")||l.includes("--help")){if(t(),p)return;process.exit(0)}const m={},f=[];for(let e=0;e<l.length;e++){const t=l[e];if("-"===t)f.push(t);else if(t.startsWith("--")){const[e,r]=t.split("=");m[e.slice(2)]=r||!0}else if(t.startsWith("-")){const[e,r]=t.split("=");m[e.slice(1)]=r||!0}else f.push(t)}if(n.hasOwnProperty("skipCreateStreamFunctions")&&!0===n.skipCreateStreamFunctions)f.length>0&&(i.args=f);else{const[e,t]=f;i.in=function(e){const t={};if(t.name=e??"stdin","stdin"===t.name)t.createStream=()=>process.stdin,t.isDir=()=>!1;else{const e=s.resolve(t.name);try{r.accessSync(e,r.constants.R_OK)}catch(e){throw console.error(e),new Error(`Could not ${e.syscall} "${e.path}"`)}t.createStream=()=>r.createReadStream(e),t.isDir=()=>r.lstatSync(e).isDirectory(),t.files=()=>r.lstatSync(e).isDirectory()?r.readdirSync(e,{withFileTypes:!0}).filter((e=>e.isFile()&&isSupportedFileExtension(s.extname(e.name.slice(1))))).map((e=>e.name)):e}return t}(e),i.out=function(e){const t={};if(t.name=e??"stdout","stdout"===t.name)t.createStream=()=>process.stdout,t.isDir=()=>!1;else{const e=s.resolve(t.name);if(u("dest=",e),t.name.endsWith(s.sep))a(e)||c(e),t.name=e,t.createStream=()=>r.createWriteStream(e,{flags:"w"}),t.isDir=()=>!0;else{const n=s.dirname(t.name);a(n)||c(n),t.name=t.name,t.createStream=()=>r.createWriteStream(e,{flags:"w"}),t.isDir=()=>!1}}return t}(t),i.args=f.slice(2)}var h;function g(e,t){let r=!1;if(u("nameAndAliases=",e),u("parameterCollection=",t),null!=t)if(Array.isArray(t)&&t.length)r=e.some((e=>t.includes(e)));else{if("object"!=typeof t)throw console.error("Unexpected error in checkCollectionForNameOrAlias(). nameAndAliases=",e,", parameterCollection=",t),new Error("Unexpected error (and nothing coded to handle it)");r=e.some((e=>t.hasOwnProperty(e)))}return r}return Object.keys(m).length>0&&(i.options=m),h=i,o.forEach((e=>{!function(e,t){let r=[e.name];if(e.aliases&&(r=r.concat(e.aliases)),!function(e,t){return g(e,t.args)||g(e,t.options)}(r,t))throw new Error('Required field "'+e.name+'" was not found')}(e,h)})),i};export{i as exists,o as isSupportedFileExtension,d as parseArguments,l as simpleProjectRootDir};
//# sourceMappingURL=index.js.map
